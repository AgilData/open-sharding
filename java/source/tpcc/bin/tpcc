#!/usr/bin/env ruby

# tpcc
#
# Copyright (c) 2011 CodeFutures Corporation. All rights reserved.
#

require 'fileutils'
require 'pathname'

file = File.open("/root/open-sharding/java/source/tpcc/bin/tpcc.properties","r")
if(!file)
  puts "Failed to open properties file."
  exit
end


while(line = file.gets)

  while line.eql?("\n")
    line = file.gets
  end
  
  while line.match("#")
    line = file.gets
  end
  
  tempLine = line.split("=")
  puts tempLine
  puts tempLine[0] + " " + tempLine[1]

 
  
end
  

# Set the base dir. Expand path gives the absolute path of the current file, dirname gives the bin dir, and dirname again gives the parent dir.
BASEDIR = File.dirname(File.dirname(Pathname.new(__FILE__).realpath))

JAVA = "java"
CLASS = "org.opensharding.tpcc.Tpcc"
OPTIONS = "-Dfile.encoding=UTF8"
HEAPSIZE = "128m"
XMS = "-Xms16m"
XMX = "-Xmx#{HEAPSIZE}"


jars = "#{BASEDIR}/tpcc-jars/*.jar"

class_path = "-classpath #{BASEDIR}/conf:#{Dir.glob(jars).join(':')}"

cmd = [JAVA, OPTIONS, XMS, XMX, class_path, CLASS, flags].join(' ')
    
puts cmd

# Run the command. Use exec, this outputs STDOUT and STDERR for the process.
exec(cmd)
            
exit 0