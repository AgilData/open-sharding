#!/usr/bin/env ruby

# tpcc
#
# Copyright (c) 2011 CodeFutures Corporation. All rights reserved.
#

require 'fileutils'
require 'pathname'

  

# Set the base dir. Expand path gives the absolute path of the current file, dirname gives the bin dir, and dirname again gives the parent dir.
BASEDIR = File.dirname(File.dirname(Pathname.new(__FILE__).realpath))

JAVA = "java"
CLASS = "org.opensharding.tpcc.Tpcc"
OPTIONS = "-Dfile.encoding=UTF8"
HEAPSIZE = "512m"
XMS = "-Xms16m"
XMX = "-Xmx#{HEAPSIZE}"
JPROFILER = "-agentpath:/opt/jprofiler6/bin/linux-x64/libjprofilerti.so=offline,id=285,config=/root/smoketest/jprofiler/jprofiler-config.xml -Xbootclasspath/a:/opt/jprofiler6/bin/agent.jar"

jars = "#{BASEDIR}/tpcc-jars/*.jar"

class_path = "-classpath #{BASEDIR}/conf:#{Dir.glob(jars).join(':')}"

cmd = [JAVA, OPTIONS, XMS, XMX, class_path, CLASS, ARGV].join(' ')

#cmd = [JAVA, OPTIONS, XMS, XMX, JPROFILER, class_path, CLASS].join(' ')

puts cmd

# Run the command. Use exec, this outputs STDOUT and STDERR for the process.
exec(cmd)
            
exit 0